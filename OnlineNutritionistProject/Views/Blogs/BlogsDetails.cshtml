@model Blog

@{
    ViewData["Title"] = "BlogsDetails";
    Layout = "~/Views/Shared/_UILayout.cshtml";
}

<style>
    .user-image {
        width: 100px;
        height: 100px;
        border-radius: 50%;
    }

    .comment-image {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        margin-right: 10px;
    }

    .submit {
        margin-top: 15px;
    }

    .btn-like {
        background-color: #e0e0e0; /* Grinin açık tonu */
        color: #000000;
        border: none;
        padding: 10px 20px;
        border-radius: 50px; /* Yuvarlak buton */
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
        display: flex;
        align-items: center;
        transition: background-color 0.3s ease, transform 0.2s ease;
    }

        .btn-like:hover {
            background-color: #b0b0b0; /* Daha koyu gri */
            transform: scale(1.05); /* Hover efekti */
        }

        .btn-like.liked {
            background-color: #1877f2; /* Beğenilmiş mavi */
            color: #ffffff;
        }

            .btn-like.liked:hover {
                background-color: #165eab; /* Daha koyu mavi */
            }

        .btn-like i {
            margin-right: 8px;
        }

            .btn-like i.fa-thumbs-up {
                color: inherit; /* İkonun butonla uyumlu rengi */
            }

        .btn-like.liked i.fa-thumbs-up {
            color: #ffffff; /* Beğenilmiş durumda beyaz ikon */
        }

        .btn-like i.fa-thumbs-up {
            color: #000000; /* Beğenilmemiş durumda siyah ikon */
        }

    .pinned-comment {
        border: 2px solid #e67e22;
        background-color: #ffffff;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
        position: relative;
    }

        .pinned-comment::before {
            content: "📌 Sabitlenmiş Yorum";
            position: absolute;
            top: 5px;
            right: 10px;
            font-size: 1rem;
            color: #e67e22;
            font-weight: bold;
        }

    .blog-like {
        background-color: #eaeaea; /* Hafif gri, daha belirgin bir arka plan rengi */
        padding: 10px 15px; /* Üstten ve alttan padding'i azalt */
        border-radius: 10px; /* Yuvarlatılmış köşeler */
        border: 1px solid #ccc; /* Daha ince ve hafif gri kenar sınırı */
        display: flex;
        align-items: center;
        justify-content: space-between;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Hafif gölge efekti */
        margin: 0 auto; /* Ortalamak için margin */
    }



    .like-container {
        display: flex;
        align-items: center;
        width: 100%; /* Kapsayıcıyı tam genişlikte yapar */
        justify-content: space-between; /* Butonu sola, beğeni sayısını sağa hizalar */
    }

    .like-info {
        display: flex;
        align-items: center;
        margin-left: 10px; /* Buton ile beğeni sayısı arasına boşluk */
        border-bottom: 1px solid #ccc; /* Beğeni sayısının altına çizgi ekler */
        padding-bottom: 4px; /* Çizginin üst kısmıyla içerik arasına boşluk ekler */
    }

    .like-count {
        font-size: 14px;
        color: #666; /* Daha yumuşak bir koyu gri */
        margin-right: 5px; /* Beğeni sayısından yazıya boşluk */
        font-weight: bold; /* Kalın punto */
    }

    .like-text {
        font-size: 14px;
        color: #666; /* Daha yumuşak bir koyu gri */
        font-weight: bold; /* Kalın punto */
        margin-left: 0; /* Sola kaydırmak için margin-left ayarlandı */
        padding-left: 5px; /* Hafif sola kaydırma efekti */
    }

    .btn-like {
        background-color: #e0e0e0; /* Hafif gri */
        color: #000; /* Metin rengi */
        border: 1px solid #ccc; /* Buton kenarı için açık gri sınır */
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        display: flex;
        align-items: center;
    }

        .btn-like.liked {
            background-color: #004085; /* Beğenildiğinde koyu mavi */
        }

        .btn-like i {
            margin-right: 5px; /* İkon ile metin arasına boşluk */
        }

</style>

<section id="blog" class="parallax-section">
    <div class="container">
        <div class="row">
            <div class="col-md-8 col-sm-7">
                <div class="blog-content wow fadeInUp" data-wow-delay="1s">
                    <h3>@Model.Description , feautreuserıd = @ViewBag.Featurefilter , userıd:@ViewBag.AppuserId</h3>
                    <span class="meta-date"><a href="#">@(((DateTime)Model.CreatedDate).ToString("dd-MMM-yyyy"))</a></span>
                    <span class="meta-comments"><a href="#blog-comments">|@ViewBag.LikeCount Beğeni|</a></span>
                    <span class="meta-author"><a href="#blog-author">@Model.AppUser.Name @Model.AppUser.Surname</a></span>
                    <div class="blog-clear"></div>
                    <p>Lorem ipsum dolor sit amet, maecenas eget vestibulum justo imperdiet, wisi risus purus augue vulputate voluptate neque, curabitur dolor libero sodales vitae elit massa. Lorem ipsum dolor sit amet, maecenas eget vestibulum justo imperdiet.</p>
                    <p>Lorem ipsum dolor sit amet, maecenas eget vestibulum justo imperdiet, wisi risus purus augue vulputate voluptate neque, curabitur dolor libero sodales vitae elit massa.</p>

                    <div class="blog-image wow fadeInUp" data-wow-delay="0.9s">
                        <img src="@Model.CoverImage" class="img-responsive" alt="blog">
                    </div>

                    <blockquote>
                        Lorem ipsum dolor sit amet, consectetur adipisicing elit. Sequi, quisquam, aut, eum, natus excepturi impedit ipsa rerum ratione id dolores ducimus minus eos quod veniam similique fugit illum error facilis!
                    </blockquote>
                    <p>Sed tempus elementum purus. Maecenas porta lobortis dui, vitae ornare lacus iaculis eu. Sed in tristique mauris. Sed vel nulla mi. Aliquam vulputate hendrerit fermentum. Nullam at ornare elit. Nulla ut commodo nulla. Nam bibendum feugiat enim nec lobortis. Etiam hendrerit blandit augue lacinia finibus.</p>
                </div>

                <div class="blog-author wow fadeInUp" data-wow-delay="1s">
                    <div class="media">
                        <div class="media-object pull-left">
                            <a href="#"><img src="/memberimages/@Model.AppUser.ImageUrl" class="img-responsive user-image" alt="blog"></a>
                        </div>
                        <div class="media-body">
                            <h4 class="media-heading">@Model.AppUser.Name @Model.AppUser.Surname</h4>
                            <p>Lorem ipsum dolor sit amet, maecenas eget vestibulum justo imperdiet, wisi risus purus augue vulputate voluptate neque, curabitur.</p>
                        </div>
                    </div>
                </div>

                <div class="blog-like">
                    @if (User.Identity.IsAuthenticated)
                    {
                        <div class="like-container">
                            @await Html.PartialAsync("/Views/Blogs/LikeCount.cshtml", new CoreLayer.Models.BlogFeature())
                        </div>
                        <span class="like-info">
                            <span class="like-count">@ViewBag.LikeCount</span>
                            <span class="like-text"> Beğeni</span>
                        </span>
                    }
                    else
                    {
                        <a href="/SignIn/SignIn">Lütfen like atmak için giriş yapınız!</a>
                    }
                </div>

                <div class="blog-comment wow fadeInUp" data-wow-delay="1s">
                    <h3>Yorumlar</h3>
                    @foreach (var item in Model.Comments)
                    {
                        @if (item.PinnetComment == true)
                        {
                            <div class="media pinned-comment">
                                @if (item.AppUser != null && item.AppUser.ImageUrl != null)
                                {
                                    <img src="/memberimages/@item.AppUser.ImageUrl" class="img-responsive comment-image" alt="blog">
                                }
                                else
                                {
                                    <img src="/path/to/default/image.jpg" class="img-responsive comment-image" alt="default">
                                }
                                <div class="media-body">
                                    <h4 class="media-heading">
                                        @item.AppUser.Name @item.AppUser.Surname
                                    </h4>
                                    <p>@item.CommentContent</p>
                                    @if (Model.AppUserId == @ViewBag.AppuserId)
                                    {
                                        <a class="btn btn-danger" asp-action="UnpinComment" asp-controller="Blogs" asp-route-id="@item.Id">Sabitlemeyi Kaldır</a>
                                    }
                                </div>
                            </div>
                        }
                    }
                    @foreach (var item in Model.Comments)
                    {
                        @if (item.PinnetComment == false)
                        {
                            @if (item.AppUser != null)
                            {
                                <div class="media">
                                    @if (item.AppUser.ImageUrl != null)
                                    {
                                        <img src="/memberimages/@item.AppUser.ImageUrl" class="img-responsive comment-image" alt="blog">
                                    }
                                    else
                                    {
                                        <img src="/path/to/default/image.jpg" class="img-responsive comment-image" alt="default">
                                    }
                                    <div class="media-body">
                                        <h4 class="media-heading">
                                            @item.AppUser.Name @item.AppUser.Surname
                                        </h4>
                                        <h5>@(((DateTime)item.CreatedDate).ToString("dd-MMM-yyyy"))</h5>
                                        <p>@item.CommentContent</p>
                                        @if (Model.AppUserId == @ViewBag.AppuserId)
                                        {
                                            <a class="btn btn-success" asp-action="PinComment" asp-controller="Blogs" asp-route-id="@item.Id">Yorumu Sabitle</a>
                                        }
                                    </div>
                                </div>
                                <hr style="border: 1px solid #ddd; margin: 20px 0;">
                            }
                            else
                            {
                                <div class="media">
                                    <div class="media-body">
                                        <h4 class="media-heading">
                                            Bilinmeyen Kullanıcı
                                        </h4>
                                        <h5>@(((DateTime)item.CreatedDate).ToString("dd-MMM-yyyy"))</h5>
                                        <p>@item.CommentContent</p>
                                        @if (Model.AppUserId == @ViewBag.AppuserId)
                                        {
                                            <a class="btn btn-success" asp-action="PinComment" asp-controller="Blogs" asp-route-id="@item.Id">Yorumu Sabitle</a>
                                        }
                                    </div>
                                </div>
                            }
                        }
                    }
                </div>

                @if (User.Identity.IsAuthenticated)
                {
                    <div class="leave-comment-form mt-5" id="reply">
                        <h4 class="side-title mb-2">Bir Yorum Bırakın</h4>
                        <form method="post" asp-action="AddComment" asp-controller="Blogs">
                            <input type="hidden" name="BlogId" value="@Model.Id" />
                            <input type="hidden" name="AppUserId" value="@ViewBag.AppUserId" />
                                <textarea name="CommentContent" class="form-control comment-input" placeholder="Yorumunuzu buraya yazın..."></textarea>
                            <button type="submit" class="btn btn-style submit">Yorum Yap</button>
                        </form>
                    </div>
                }
                else
                {
                    <div class="alert alert-info mt-3">
                        Yorum yapabilmek için giriş yapmalısınız. <a href="/SignIn/SignIn">Giriş Yap</a>
                    </div>
                }
                <script>
                    document.addEventListener("DOMContentLoaded", function () {
                        var commentInput = document.querySelector(".comment-input");
                        commentInput.style.height = "150px";
                    });
                </script>
            </div>
            <script>
                document.addEventListener("DOMContentLoaded", function () {
                    const likeButton = document.getElementById("likeButton");
                    const likeForm = document.getElementById("likeForm");
                    const unlikeForm = document.getElementById("unlikeForm");

                    if (likeForm) {
                        likeForm.addEventListener("submit", function (e) {
                            e.preventDefault();
                            likeButton.classList.add("liked");
                            this.submit(); // Formu submit etmeye devam eder.
                        });
                    }

                    if (unlikeForm) {
                        unlikeForm.addEventListener("submit", function (e) {
                            e.preventDefault();
                            likeButton.classList.remove("liked");
                            this.submit(); // Formu submit etmeye devam eder.
                        });
                    }
                });

            </script>

            <div class="col-md-4 col-sm-5 wow fadeInUp" data-wow-delay="1.3s">
                @await Component.InvokeAsync("_LastBooks")
                @await Component.InvokeAsync("_LastBlogs")
            </div>
        </div>
    </div>
</section>
